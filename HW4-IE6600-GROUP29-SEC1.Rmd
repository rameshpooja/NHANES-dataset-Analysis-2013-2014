---
title: "HW4-IE660-Group29-Sec1"
author: "Pooja Ramesh - 002765237, Chaitanya Gudipati - 002789152, Indrayani Yadav - 002653543 "
date: "2023-02-07"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# Problem Statement 
To understand and perform visualizations in R programming using R packages such as ggplot,dplyr, gridextra, tidyr, treemapify, plotly and get familiarized with visualizations in the Rstudio environment.To get accustomed to tackling geoms, aesthetics in R programming and design visually appealing graphics like donut charts, tree map, bar charts, alluvial charts and so on.

## Loading libraries
```{r task, echo=TRUE, warning=FALSE}


library(ggplot2)
library(dplyr)
library(gridExtra)
library(readr)
library(tidyr)
#install.packages("treemap")
library(treemap)
library(webr)
library(plotly)
#install.packages("gridExtra", dependencies = TRUE)
#install.packages("corrplot") 
#install.packages("treemapify")
library(treemapify)
library(corrplot)
library(RColorBrewer)
library(stringr)
library(tidyverse)
library(ggalluvial)
#install.packages("ggalluvial")
#install.packages("ggplot2")
#Display working directory 
getwd()

```

## Task 1 
Generate the density plot similar to what is shown in the figure: (Airline_delay dataset)



```{r task 1, echo=FALSE, warning=FALSE}
#Task 1 
library(ggplot2)

#To read the data from airline_delay.csv
df_airline <- read.csv('/Users/poojaramesh/Downloads/airlines_delay.csv', na.strings = "")
colnames(df_airline)
head(df_airline)

#Selecting the types of delay from the airline dataset
df_airline_1 <- df_airline %>%
  select(c(12:16))%>%
  drop_na()

#Using geom_density and ggplot to plot the density plots
dens_p2 <- ggplot(data = df_airline_1)+ 
  geom_density(aes(x=log(carrier_delay), fill='red',alpha=0.3))+
  geom_density(aes(x=log(late_aircraft_delay), fill = 'blue', alpha=0.3))+
  geom_density(aes(x=log(nas_delay), fill= 'pink',alpha=0.3))+
  geom_density(aes(x=log(security_delay), fill = 'green',alpha=0.3))+
  geom_density(aes(x=log(weather_delay), fill = 'yellow',alpha=0.3))+
  scale_fill_discrete(name = "Delay Type", labels = c("carrier_delay","late_aircraft_delay", "nas_delay", "security_delay", "weather_delay"))+
  xlab("log delay in mins")+
  ylab("Density")+
  ggtitle("Density plot of carrier delays in minutes")

#To display the output
dens_p2 
```




## Output 1 

Here, we had to create a density plot for type of airline delays. For better data spread, we transformed the x-axis to log form using the log function available so that spread is uniform. We used the ggplot function and geom _density to plot the density plot for delays.From the density plot, we observe that late_aircraft_delay has the highest density and the least log delay in minutes.

## Task 2 
Generate a correlation plot for arr_flights,arr_cancelled, arr_diverted, arr_delay, carrier_delay, weather_delay, security_delay, nas_delay, late_aircraft_delay.



```{r task 2, echo=FALSE, warning=FALSE}
#Task 2

#Selecting the columns specified in the task
df_airlines_2 <- df_airline%>%
  select(c(7:16))%>%
  na.omit()

#Computing correlation for the columns specified
cor_mat <- cor(df_airlines_2)

#plotting the correlation plot using corrplot.mixed()
corrplot.mixed(cor_mat, lower = "number",
               upper = "circle",order="hclust",tl.cex= 0.32, tl.pos ='d',tl.srt = 45)
               
```


## Output 2 

Here,in this task, we had to generate a correlation plot for arr_flights,arr_cancelled, arr_diverted, arr_delay, carrier_delay, weather_delay, security_delay, nas_delay, late_aircraft_delay columns. We used the cor function calculate the correlation between the columns and corrplot.mixed() function to generate the graphic. Here, we observe that the correlation is 0.97 (highest) for two pairs of columns :1. late_aircraft_delay and arr_delay & 2. arr_del15 and arr_delay. Furthermore, we observe that the  lowest correlation is 0.24 between security_delay and arr_cancelled.

## Task 3 
Based on your observations, create any visualization.



```{r task 3, echo=FALSE, warning=FALSE}
#Bar plot
#Task 3 

#computing the total delays by including all factors that create delay and then arranging them in descending order
df_airline_3 <- df_airline %>% 
  select(arr_del15,arr_cancelled,arr_diverted,arr_delay,carrier_delay,weather_delay,nas_delay,security_delay,late_aircraft_delay, carrier_name) %>%
  filter(!is.na(carrier_name)) %>%
  group_by(carrier_name) %>%
  summarise(n = n(), total = sum(arr_del15,arr_cancelled,arr_diverted,arr_delay,carrier_delay,weather_delay,nas_delay,security_delay,late_aircraft_delay))%>%
  arrange(desc(n)) 

#Plotting barplots for the delays 
df_airline_plot <- ggplot(df_airline_3, aes(x=reorder(carrier_name,n), y=n)) + 
  geom_bar(stat="identity", fill='blue') +
  coord_flip()  +
  labs(title = "Airline Total Delays",
       x = "Airlines",
       y = "Total Delays")

#To display the output
df_airline_plot 

```


## Output 3 

We had to choose and plot a visualization according to the airline_delay data set. Since it is a categorical data, we decided that the bar plot is a perfect fit. Here, we compute the total delays i.e delays due to arrival and departure of the air-crafts and generate a bar plot for the visualization. We observe that the Skywest airlines have the highest delays and ExpressJet Airlines LLC has the least total delays.

## Task 4
From the wages.csv data-set, we need to generate heat map similar to the one shown below. The variable difference is defined as the difference between number of male employees and the number of female employees. A negative value indicates a greater number of female than male employees.



```{r task 4, echo=FALSE, warning=FALSE}
library(tidyr)
wages_df <- read.csv("/Users/poojaramesh/Downloads/wages_jobs.csv")
diff_df <- wages_df[c('Year','Gender','PUMS.Occupation','Total.Population')] %>%
  pivot_wider(names_from = Gender,values_from = Total.Population) %>% 
  mutate(difference = Male-Female)
ggplot(diff_df, aes(Year,PUMS.Occupation)) +
  geom_tile(aes(fill = difference)) + ylab("Occupation")+
  scale_fill_distiller(palette = "Spectral")
```


## Output 4


Here, we have sampled the data by creating the data frame (wages_df) and grouping by year and occupation to get the count by gender. Pivot_wider is used to wider form of the table, in this case to get the count of gender. Then, we calculate difference between female and male count. ggplot() function is used to plot the graph with aesthetics of year and occupation meanwhile we use geom_tile() to plot graph as a tile. From the graph, it can be inferred that number of females is more than males for the categories of flight attendant and customer service representatives, meanwhile it is vice versa for the categories such as pilots & flight engineers and mechanics and service technicians.Furthermore, we notice that the number of makes and females in almost same for reservation, transportation ticket agents and travel clerks.

## Task 5 
From the wages.csv data-set, generate an alluvial chart like the one given.



```{r task 5, echo=FALSE, warning=FALSE}

ggplot(wages_df,
       aes(y = Total.Population, axis1 = PUMS.Occupation, axis2 =Year)) +
  geom_alluvium(aes(fill = Gender)) +
  geom_stratum(width = 1/2.9, fill = "white", color = "grey") +
  geom_text(stat = "stratum", aes(label = after_stat(stratum)),size =1.3) +
  scale_x_discrete(limits = c("Occupation", "Year"), expand = c(.15, .05)) + ylab("Total population")+
  scale_fill_brewer(type = "qual", palette = "Set1")+
  theme_minimal()
               
```


## Output 5 


Here, we used the ggplot2,ggalluvial library and geom_alluvium() for creating the alluvial chart where the y axis represents the total population and the x-axis represents the occupation and year. The color fills represents the gender.Here, we can conclude that there is slight growth in number of females in aircraft pilots and flight engineer roles over the years. More number of females count is observed in flight attendants and customer service related roles whereas the male count is more in pilots,mechanics and service technicians and flight engineers.Here, we notice that majority of the roles in the data set belong to aircraft pilots and flight attendants.

## Task 6 
From occupations.csv, generate a stacked bar plot for the year 2018 with occupation and average wage as the axis and gender as the color.



```{r task 6, echo=FALSE, warning=FALSE}

S1 <- wages_df%>%
group_by(Year='2018')
S1 
W2 <- ggplot(data=S1, aes(x=PUMS.Occupation, y=Average.Wage, fill=Gender)) +
      geom_bar(stat="identity")+coord_flip()+ xlab("Average Wage") +ylab("Occupation")
W2
               
```


## Output 6


Here, we use the stacked bar chart with the library ggplot() and we denote the x-axis as occupation and y-axis as average wages.From the graph it is observed that, aircraft pilots and engineers have the highest average salary followed by mechanics and technicians. Also, customer service representatives has the lowest average salary.

## Task 7 
From the occupations.csv data-set,generate the following tree map. The area of each rectangle is proportional to the number of people working in that detailed occupation.



```{r task 7, echo=FALSE, warning=FALSE}
#Task 7
#reading the occupation data 
occupation_df <- read.csv("/Users/poojaramesh/Downloads/occupations.csv")

occupation_df_1 <- occupation_df %>%
 group_by(Major.Occupation.Group, Detailed.Occupation) %>%
 dplyr::summarise(Total= sum(Total.Population))%>%
  tidyr::drop_na()
          
#plot the treemap
df_plot_occupation<- ggplot(occupation_df_1,
aes(area = Total,
fill = Major.Occupation.Group,
subgroup = Major.Occupation.Group,
label = Detailed.Occupation))+
geom_treemap(layout = 'scol') +
geom_treemap_text(colour = "black", place = "centre", grow = F, reflow = F) +
scale_fill_discrete(name = "Major Occupation Group")+
ggtitle('Workforce Distribution by Detailed Occupation ') +
theme_minimal()

df_plot_occupation
```


## Output 7 


Treemap is generated for the Detailed occupation and total population.The size of rectangle is proportional to the population of that particular group using the geom treemap function from the package.From the graph it can be seen that the count of waiters and waitress,Bartenders is highest.

## Task 8 
Explore plotly in r and create any chart of your choice from the dataset provided in this homework.




```{r task 8, echo=FALSE, warning=FALSE}
#Task 8
fig <- plot_ly()
data1 <- occupation_df[,c('Broad.Occupation','Average.Wage')]
fig <- fig %>% add_pie(data = data1, labels = ~Broad.Occupation, values = ~Average.Wage,
          name = "Cut", domain = list(x = c(0, 0.4), y = c(0.4, 1)))
data2 <- occupation_df[,c('Broad.Occupation','Total.Population')]
fig <- fig %>% add_pie(data = data2, labels = ~Broad.Occupation, values = ~Total.Population,
          name = "Color", domain = list(x = c(0.6, 1), y = c(0.4, 1)))
fig <- fig %>% layout(title = "Pie Charts with Subplots", showlegend = F,
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

fig
```


## Output 8



Pie charts are created to show the percentage distribution of average wages and total population for different groups of broad occupations using add_pie function from plotly package.The first subplot shows the distribution of average wage among the broad occupations and it can be seen that Management occupations has the highest percentage which is 23.6%.The second subplot shows the distribution of total population among broad occupations and food preparation and service related occupation has almost three-fouth's of population which is 70%.

## Task 9 
Pick any hex colors and create a donut chart from any of the data sets provided in this homework.



```{r task 9, echo=FALSE, warning=FALSE}
#Task 9
plotly::plot_ly(occupation_df) %>%
  add_pie(occupation_df, labels = ~Major.Occupation.Group,values= ~Total.Population,
           textposition = 'inside',
          marker = list(colors=c("#CCCCFF", "#00ff00", "#0000ff","#FFA500", "#FFC0CB")),
          textinfo = "percent",type = 'pie', hole=0.3) %>%
  layout(title = "Percentage distribution of Total Population for diffrent Major Occupation Groups")
```


## Output 9



Here, Donut chart is created to show the percentage distribution of total population among major occupation groups using add_pie function from plotly package. From the chart it can be seen that majority of the population is into service occupation sector and least percentage of population are into natural resources, construction and maintenance  occupations.

# Conclusion
This assignment gave us a well rounded understanding of how to use the packages and functions for plotting graphs, explore data sets using visualizations and perform complex analysis using them in Rstudio using R programming language. Furthermore, we were introduced to various types of visualizations such as bar graphs, correlation plots, area plots, pie charts, alluvial plots, and tree maps, which can help in creating aesthetic and organised visuals, using the packages ggplot,dplyr, gridextra, tidyr, treemapify, plotly.